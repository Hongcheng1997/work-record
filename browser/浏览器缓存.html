<!DOCTYPE html>
<html lang="en-US">
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width,initial-scale=1">
    <title>浏览器缓存 | 个人学习博客</title>
    <meta name="generator" content="VuePress 1.9.7">
    
    <meta name="description" content="Just playing around">
    
    <link rel="preload" href="/work-record/assets/css/0.styles.68f3643a.css" as="style"><link rel="preload" href="/work-record/assets/js/app.a757e0f6.js" as="script"><link rel="preload" href="/work-record/assets/js/2.70ac8c2a.js" as="script"><link rel="preload" href="/work-record/assets/js/8.54d4f16d.js" as="script"><link rel="prefetch" href="/work-record/assets/js/10.1d825909.js"><link rel="prefetch" href="/work-record/assets/js/11.e5868fc7.js"><link rel="prefetch" href="/work-record/assets/js/12.c9f2066e.js"><link rel="prefetch" href="/work-record/assets/js/13.56c1fccc.js"><link rel="prefetch" href="/work-record/assets/js/14.e76761fc.js"><link rel="prefetch" href="/work-record/assets/js/15.b0380b6a.js"><link rel="prefetch" href="/work-record/assets/js/16.92b21b22.js"><link rel="prefetch" href="/work-record/assets/js/17.9a5b840d.js"><link rel="prefetch" href="/work-record/assets/js/18.0aab2aea.js"><link rel="prefetch" href="/work-record/assets/js/19.72d5f028.js"><link rel="prefetch" href="/work-record/assets/js/20.6101b765.js"><link rel="prefetch" href="/work-record/assets/js/3.31091237.js"><link rel="prefetch" href="/work-record/assets/js/4.244e7092.js"><link rel="prefetch" href="/work-record/assets/js/5.46e8e12d.js"><link rel="prefetch" href="/work-record/assets/js/6.1d49ccc6.js"><link rel="prefetch" href="/work-record/assets/js/7.79cb8b03.js"><link rel="prefetch" href="/work-record/assets/js/9.e9a91a22.js">
    <link rel="stylesheet" href="/work-record/assets/css/0.styles.68f3643a.css">
  </head>
  <body>
    <div id="app" data-server-rendered="true"><div class="theme-container"><header class="navbar"><div class="sidebar-button"><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" role="img" viewBox="0 0 448 512" class="icon"><path fill="currentColor" d="M436 124H12c-6.627 0-12-5.373-12-12V80c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12z"></path></svg></div> <a href="/work-record/" class="home-link router-link-active"><!----> <span class="site-name">个人学习博客</span></a> <div class="links"><div class="search-box"><input aria-label="Search" autocomplete="off" spellcheck="false" value=""> <!----></div> <!----></div></header> <div class="sidebar-mask"></div> <aside class="sidebar"><!---->  <ul class="sidebar-links"><li><section class="sidebar-group collapsable depth-0"><p class="sidebar-heading open"><span>网络协议</span> <span class="arrow down"></span></p> <ul class="sidebar-links sidebar-group-items"><li><a href="/work-record/network/Http.html" class="sidebar-link">Http 协议</a></li><li><a href="/work-record/network/Https.html" class="sidebar-link">Https 协议</a></li><li><a href="/work-record/network/Tcp.html" class="sidebar-link">TCP 协议</a></li></ul></section></li></ul> </aside> <main class="page"> <div class="theme-default-content content__default"><h1 id="浏览器缓存"><a href="#浏览器缓存" class="header-anchor">#</a> 浏览器缓存</h1> <h3 id="缓存位置"><a href="#缓存位置" class="header-anchor">#</a> 缓存位置</h3> <ol><li><p>Service Worker
Service Worker 是运行在浏览器背后的独立线程，一般可以用来实现缓存功能.Service Worker 的缓存与浏览器其他内建的缓存机制不同，它可以让我们自由控制缓存哪些文件、如何匹配缓存、如何读取缓存，并且缓存是持续性的</p></li> <li><p>Memory Cache
内存中的缓存,主要包含的是当前中页面中已经抓取到的资源,例如页面上已经下载的样式、脚本、图片等,一旦关闭 Tab 页面，内存中的缓存也就被释放了</p></li> <li><p>Disk Cache
存储在硬盘中的缓存，读取速度慢点，但是什么都能存储到磁盘中</p></li> <li><p>Push Cache
是 HTTP/2 中的内容，当以上三种缓存都没有命中时，它才会被使用。它只在会话（Session）中存在，一旦会话结束就被释放，并且缓存时间也很短暂</p></li></ol> <h3 id="强缓存"><a href="#强缓存" class="header-anchor">#</a> 强缓存</h3> <p>不会向服务器发送请求，直接从缓存中读取资源。Network请求返回200状态码，并且Size显示from disk cache或from memory cache。可设置expires 和 cache-control实现强缓存</p> <ol><li><p>expires
缓存过期时间，用来指定资源到期时间，结合Last-modified使用，在响应http请求时告诉浏览器在过期时间前使用缓存，不需要请求。受限于本地时间，如果本地时间修改，可能造成缓存失效</p></li> <li><p>cache-control
控制网页缓存 如Cache-Control:max-age=300时，则代表在这个请求正确返回时间（浏览器也会记录下来）的5分钟内再次加载资源，就会命中强缓存</p></li></ol> <ul><li>public：所有内容都将被缓存（客户端和代理服务器都可缓存）</li> <li>private:所有内容只有客户端可以缓存</li> <li>no-cache:表示不使用 Cache-Control的缓存控制方式做前置验证，而是使用 Etag 或者Last-Modified字段来控制缓存</li> <li>no-store：所有内容都不会被缓存，即不使用强制缓存，也不使用协商缓存</li> <li>max-age:缓存内容多久后失效</li> <li>max-stale：能容忍的最大过期时间</li> <li>s-maxage（单位为s)：同max-age作用一样，只在代理服务器中生效（比如CDN缓存）</li> <li>min-fresh：能够容忍的最小新鲜度</li></ul> <h3 id="协商缓存"><a href="#协商缓存" class="header-anchor">#</a> 协商缓存</h3> <p>强缓存失效后，浏览器携带缓存标识向服务器发起请求，由服务器根据缓存标识决定是否用缓存的过程</p> <ul><li>协商缓存生效返回 304和node modified</li> <li>协商缓存失效返回 200和请求结果</li></ul> <p>通过 Last-Modified 和 ETag  实现</p> <ol><li>Last-Modified和If-Modified-Since
浏览器第一次发送请求，服务器返回资源时将这个资源的最后修改时间添加到Last-Modified,浏览器接收后缓存。浏览器再次请求时检测到Last-Modified，将Last-Modified的值添加到If-Modified-Since返回给服务端，服务端根据这个值去对比当前资源的最后修改时间，没变化返回304 从缓存中取，如果If-Modified-Since的时间小于服务器中这个资源的最后修改时间，说明文件有更新，于是返回新的资源文件和200</li></ol> <p>存在问题：</p> <ul><li>本地打开缓存文件就会导致Last-Modified，发送相同资源</li> <li>Last-Modified只能以秒计时</li></ul> <ol start="2"><li>ETag和If-None-Match
Etag是服务器响应请求时，返回当前资源文件的一个唯一标识(由服务器生成)，只要资源有变化，Etag就会重新生成。
原理类似   浏览器再次请求时将Etag放在If-None-Match返回到服务端 服务端匹配</li></ol> <h3 id="缓存机制"><a href="#缓存机制" class="header-anchor">#</a> 缓存机制</h3> <p>强制缓存优先于协商缓存进行，若强制缓存(Expires和Cache-Control)生效则直接使用缓存，若不生效则进行协商缓存(Last-Modified / If-Modified-Since和Etag / If-None-Match)，协商缓存由服务器决定是否使用缓存，若协商缓存失效，那么代表该请求的缓存失效，返回200，重新返回资源和缓存标识，再存入浏览器缓存中；生效则返回304，继续使用缓存</p> <h3 id="用户行为对浏览器缓存的影响"><a href="#用户行为对浏览器缓存的影响" class="header-anchor">#</a> 用户行为对浏览器缓存的影响</h3> <ul><li>地址栏输入url:查找dish cache中是否有匹配</li> <li>普通刷新：Tab没关闭 可使用memory cache 其次dish cache</li> <li>强刷：浏览器不适用缓存</li></ul> <p>&lt;-- https://juejin.cn/post/6844903757872889870 --&gt;</p></div> <footer class="page-edit"><!----> <!----></footer> <!----> </main></div><div class="global-ui"></div></div>
    <script src="/work-record/assets/js/app.a757e0f6.js" defer></script><script src="/work-record/assets/js/2.70ac8c2a.js" defer></script><script src="/work-record/assets/js/8.54d4f16d.js" defer></script>
  </body>
</html>
