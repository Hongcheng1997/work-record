<!DOCTYPE html>
<html lang="en-US">
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width,initial-scale=1">
    <title>Webpack5 新特性 | 个人学习博客</title>
    <meta name="generator" content="VuePress 1.9.7">
    
    <meta name="description" content="Just playing around">
    
    <link rel="preload" href="/assets/css/0.styles.99bb18d0.css" as="style"><link rel="preload" href="/assets/js/app.fdb65595.js" as="script"><link rel="preload" href="/assets/js/2.70ac8c2a.js" as="script"><link rel="preload" href="/assets/js/14.e76761fc.js" as="script"><link rel="prefetch" href="/assets/js/10.1d825909.js"><link rel="prefetch" href="/assets/js/11.e5868fc7.js"><link rel="prefetch" href="/assets/js/12.c9f2066e.js"><link rel="prefetch" href="/assets/js/13.56c1fccc.js"><link rel="prefetch" href="/assets/js/15.b0380b6a.js"><link rel="prefetch" href="/assets/js/16.92b21b22.js"><link rel="prefetch" href="/assets/js/17.9a5b840d.js"><link rel="prefetch" href="/assets/js/18.0aab2aea.js"><link rel="prefetch" href="/assets/js/19.72d5f028.js"><link rel="prefetch" href="/assets/js/20.6101b765.js"><link rel="prefetch" href="/assets/js/3.31091237.js"><link rel="prefetch" href="/assets/js/4.244e7092.js"><link rel="prefetch" href="/assets/js/5.46e8e12d.js"><link rel="prefetch" href="/assets/js/6.1d49ccc6.js"><link rel="prefetch" href="/assets/js/7.79cb8b03.js"><link rel="prefetch" href="/assets/js/8.54d4f16d.js"><link rel="prefetch" href="/assets/js/9.e9a91a22.js">
    <link rel="stylesheet" href="/assets/css/0.styles.99bb18d0.css">
  </head>
  <body>
    <div id="app" data-server-rendered="true"><div class="theme-container"><header class="navbar"><div class="sidebar-button"><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" role="img" viewBox="0 0 448 512" class="icon"><path fill="currentColor" d="M436 124H12c-6.627 0-12-5.373-12-12V80c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12z"></path></svg></div> <a href="/" class="home-link router-link-active"><!----> <span class="site-name">个人学习博客</span></a> <div class="links"><div class="search-box"><input aria-label="Search" autocomplete="off" spellcheck="false" value=""> <!----></div> <!----></div></header> <div class="sidebar-mask"></div> <aside class="sidebar"><!---->  <ul class="sidebar-links"><li><section class="sidebar-group collapsable depth-0"><p class="sidebar-heading open"><span>网络协议</span> <span class="arrow down"></span></p> <ul class="sidebar-links sidebar-group-items"><li><a href="/network/Http.html" class="sidebar-link">Http 协议</a></li><li><a href="/network/Https.html" class="sidebar-link">Https 协议</a></li><li><a href="/network/Tcp.html" class="sidebar-link">TCP 协议</a></li></ul></section></li></ul> </aside> <main class="page"> <div class="theme-default-content content__default"><h1 id="webpack5-新特性"><a href="#webpack5-新特性" class="header-anchor">#</a> Webpack5 新特性</h1> <h2 id="_0-升级准备工作"><a href="#_0-升级准备工作" class="header-anchor">#</a> 0.升级准备工作</h2> <p>项目中的插件需要升级到 v5 支持的版本如：html-webpack-plugin、webpack-dev-server、terser-webpack-plugin、 mini-css-extract-plugin</p> <p>v5 移除了 Node.js Polyfill 会导致一些包变得不可用，如需兼容 需要安装相关的 polyfill 并在 plugin 中显示声明注入</p> <p>HMR 容易失效，需要显示配置 target:'web'</p> <h2 id="_1-优化持久缓存-提升构建性能"><a href="#_1-优化持久缓存-提升构建性能" class="header-anchor">#</a> 1.优化持久缓存 （提升构建性能）</h2> <p>v5 之前使用的是 cache-loader 将编译结果写入硬盘缓存
v5 在 cache 中配置 type: 'filesystem' 默认是 memory 写入内存 ，使得二次构建效率大幅提升，也可以修改为写入硬盘</p> <h2 id="_2-优化长期缓存"><a href="#_2-优化长期缓存" class="header-anchor">#</a> 2.优化长期缓存</h2> <p>v5 针对 moduleId 和 chunkId 计算方式进行优化：moduleId 根据上下文模块路径，chunkId 根据 chunk 内容计算 最后为 moduleId 和 chunkId 生存 3-4 位的数字 id，实现长期缓存，生产环境下默认开启
v5 之前 moduleId 和 chunkId 默认值是自增 id 容易导致文件缓存失效</p> <h2 id="_3-nodejs-的-polyfill-脚本被移除"><a href="#_3-nodejs-的-polyfill-脚本被移除" class="header-anchor">#</a> 3.NodeJs 的 polyfill 脚本被移除</h2> <p>v5 之前 对于大多数 node 模块会自动添加 polyfill 脚本并加到最终的 bundle 中导致打包结果变大（很多时候运行的代码并不需要这个）
v5 遇到这种情况会提示确认，如果不需要 node polyfill 按照提示 alias 下对应包 设为 false</p> <h2 id="_4-更好的-treeshaking"><a href="#_4-更好的-treeshaking" class="header-anchor">#</a> 4.更好的 TreeShaking</h2> <p>v4 中 针对引用模块 会将引用模块内的代码都打包，在 v5 中 只会打包引用模块内被使用的部分代码 并且 v5 内置了 prepack 生成的代码也更加简洁</p> <h2 id="_5-module-federation"><a href="#_5-module-federation" class="header-anchor">#</a> 5.Module Federation</h2> <p>让 webpack 达到线上 runtime 的效果，让代码直接在独立应用间利用 cdn 直接共享，不再需要本地安装 NPM 包、构建发布。
实现：直接将一个应用的 bundle，应用在另一个应用上
被引用应用：在 webpack.container 中导入 ModuleFederationPlugin,在插件类上配置 exposes 和 shared 其中 exposes 为需要暴露的组件，shared 为依赖的包</p> <p>引用应用：则将 exposes 改为 remotes 并设置被引用的应用，同时需要在 index.html 中 通过 script 标签导入被引用应用的入口文件 (xxx-remote-entry.js)</p> <h2 id="_6-内置静态资源构建能力-asset-modules"><a href="#_6-内置静态资源构建能力-asset-modules" class="header-anchor">#</a> 6.内置静态资源构建能力 Asset Modules</h2> <p>针对静态文件不再需要相应的 loader
直接在 module 对应规则下配置 type
asset/resource —— file-loader 把文件输出到一个文件夹中，在代码中通过相对 URL 去引用输出的文件 (处理图片和字体)
asset/source —— row-loader 将文件处理成字符串导入
asset/inline —— url-loader 当文件大小达到一定要求的时候，可以将其处理成 base64 的 URI 内置 file-loader
asset 默认会根据文件大小选择使用哪种类型</p> <h2 id="_7-其他"><a href="#_7-其他" class="header-anchor">#</a> 7.其他</h2> <p>SplitChunks 支持更灵活的资源拆分
不包含 JS 代码的 Chunk 将不再生成 JS 文件 等等</p></div> <footer class="page-edit"><!----> <!----></footer> <!----> </main></div><div class="global-ui"></div></div>
    <script src="/assets/js/app.fdb65595.js" defer></script><script src="/assets/js/2.70ac8c2a.js" defer></script><script src="/assets/js/14.e76761fc.js" defer></script>
  </body>
</html>
