<!DOCTYPE html>
<html lang="en-US">
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width,initial-scale=1">
    <title>Webpack | 个人学习博客</title>
    <meta name="generator" content="VuePress 1.9.7">
    
    <meta name="description" content="Just playing around">
    
    <link rel="preload" href="/work-record/assets/css/0.styles.68f3643a.css" as="style"><link rel="preload" href="/work-record/assets/js/app.bb96a932.js" as="script"><link rel="preload" href="/work-record/assets/js/2.8cd38eb8.js" as="script"><link rel="preload" href="/work-record/assets/js/25.8395cccb.js" as="script"><link rel="prefetch" href="/work-record/assets/js/10.0398fe80.js"><link rel="prefetch" href="/work-record/assets/js/11.ef180a16.js"><link rel="prefetch" href="/work-record/assets/js/12.6f2f5bb1.js"><link rel="prefetch" href="/work-record/assets/js/13.68b11f16.js"><link rel="prefetch" href="/work-record/assets/js/14.67c50ebd.js"><link rel="prefetch" href="/work-record/assets/js/15.431a68dd.js"><link rel="prefetch" href="/work-record/assets/js/16.23d5c1a4.js"><link rel="prefetch" href="/work-record/assets/js/17.db3a71c5.js"><link rel="prefetch" href="/work-record/assets/js/18.104ad2ba.js"><link rel="prefetch" href="/work-record/assets/js/19.dda002b1.js"><link rel="prefetch" href="/work-record/assets/js/20.8ce513f6.js"><link rel="prefetch" href="/work-record/assets/js/21.6258d690.js"><link rel="prefetch" href="/work-record/assets/js/22.f84b6063.js"><link rel="prefetch" href="/work-record/assets/js/23.1171e089.js"><link rel="prefetch" href="/work-record/assets/js/24.7a659fdb.js"><link rel="prefetch" href="/work-record/assets/js/26.73695a02.js"><link rel="prefetch" href="/work-record/assets/js/27.60d82ddc.js"><link rel="prefetch" href="/work-record/assets/js/28.fb4ae8ff.js"><link rel="prefetch" href="/work-record/assets/js/3.19d95e9d.js"><link rel="prefetch" href="/work-record/assets/js/4.323a58c7.js"><link rel="prefetch" href="/work-record/assets/js/5.99b8aeb7.js"><link rel="prefetch" href="/work-record/assets/js/6.7ead1d22.js"><link rel="prefetch" href="/work-record/assets/js/7.8be12c51.js"><link rel="prefetch" href="/work-record/assets/js/8.59d4b254.js"><link rel="prefetch" href="/work-record/assets/js/9.0f1ccd9d.js">
    <link rel="stylesheet" href="/work-record/assets/css/0.styles.68f3643a.css">
  </head>
  <body>
    <div id="app" data-server-rendered="true"><div class="theme-container"><header class="navbar"><div class="sidebar-button"><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" role="img" viewBox="0 0 448 512" class="icon"><path fill="currentColor" d="M436 124H12c-6.627 0-12-5.373-12-12V80c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12z"></path></svg></div> <a href="/work-record/" class="home-link router-link-active"><!----> <span class="site-name">个人学习博客</span></a> <div class="links"><div class="search-box"><input aria-label="Search" autocomplete="off" spellcheck="false" value=""> <!----></div> <!----></div></header> <div class="sidebar-mask"></div> <aside class="sidebar"><!---->  <ul class="sidebar-links"><li><section class="sidebar-group collapsable depth-0"><p class="sidebar-heading"><span>前端基础</span> <span class="arrow right"></span></p> <!----></section></li><li><section class="sidebar-group collapsable depth-0"><p class="sidebar-heading"><span>网络协议</span> <span class="arrow right"></span></p> <!----></section></li><li><section class="sidebar-group collapsable depth-0"><p class="sidebar-heading"><span>数据结构</span> <span class="arrow right"></span></p> <!----></section></li><li><section class="sidebar-group collapsable depth-0"><p class="sidebar-heading"><span>算法分类</span> <span class="arrow right"></span></p> <!----></section></li><li><section class="sidebar-group collapsable depth-0"><p class="sidebar-heading"><span>浏览器相关</span> <span class="arrow right"></span></p> <!----></section></li><li><section class="sidebar-group collapsable depth-0"><p class="sidebar-heading open"><span>项目工程化</span> <span class="arrow down"></span></p> <ul class="sidebar-links sidebar-group-items"><li><a href="/work-record/工程化/打包构建的思考.html" class="sidebar-link">关于构建工具的一些思考</a></li><li><a href="/work-record/工程化/webpack.html" class="active sidebar-link">webpack 相关</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/work-record/工程化/webpack.html#常用-loader" class="sidebar-link">常用 loader</a></li><li class="sidebar-sub-header"><a href="/work-record/工程化/webpack.html#常用-plugins" class="sidebar-link">常用 plugins</a></li><li class="sidebar-sub-header"><a href="/work-record/工程化/webpack.html#loader-和-plugin-的区别" class="sidebar-link">loader 和 plugin 的区别</a></li><li class="sidebar-sub-header"><a href="/work-record/工程化/webpack.html#自定义-plugin-loader" class="sidebar-link">自定义 plugin/loader</a></li><li class="sidebar-sub-header"><a href="/work-record/工程化/webpack.html#webpack-的热更新原理" class="sidebar-link">Webpack 的热更新原理</a></li><li class="sidebar-sub-header"><a href="/work-record/工程化/webpack.html#常见优化方法" class="sidebar-link">常见优化方法</a></li><li class="sidebar-sub-header"><a href="/work-record/工程化/webpack.html#webpack-构建流程" class="sidebar-link">Webpack 构建流程</a></li><li class="sidebar-sub-header"><a href="/work-record/工程化/webpack.html#webpack-构建原理" class="sidebar-link">Webpack 构建原理</a></li></ul></li></ul></section></li><li><section class="sidebar-group collapsable depth-0"><p class="sidebar-heading"><span>工具类相关</span> <span class="arrow right"></span></p> <!----></section></li></ul> </aside> <main class="page"> <div class="theme-default-content content__default"><h1 id="webpack"><a href="#webpack" class="header-anchor">#</a> Webpack</h1> <p>webpack 可以看作模块打包器，任何模块可以通过相关 loader 转译成可识别的形式打包输出，同时内部实现了一个模块系统，可以将常见的 esm 语法编译成其他的语法，如：umd、commonJs 等</p> <h2 id="常用-loader"><a href="#常用-loader" class="header-anchor">#</a> 常用 loader</h2> <ul><li>babel-loader</li> <li>css-loader、style-loader</li> <li>ts-loader</li></ul> <h2 id="常用-plugins"><a href="#常用-plugins" class="header-anchor">#</a> 常用 plugins</h2> <ul><li>HtmlWebpackPlugin</li> <li>EnvironmentPlugin</li> <li>MiniCssExtractPlugin</li> <li>HappyPack</li></ul> <h2 id="loader-和-plugin-的区别"><a href="#loader-和-plugin-的区别" class="header-anchor">#</a> loader 和 plugin 的区别</h2> <ul><li>loader 功能是对文件内容做编译，使 webpack 具备识别的不同文件格式</li> <li>plugin 可以扩展 webpack 的功能，由于 webpack 继承了 Tapable 的事件流，在各个阶段都有相应的生命周期函数，可以在函数中做自定义操作</li></ul> <h2 id="自定义-plugin-loader"><a href="#自定义-plugin-loader" class="header-anchor">#</a> 自定义 plugin/loader</h2> <ul><li>plugin</li></ul> <p>方法内必须要有 apply 方法，apply 内包含 complier 实例，可以拿到 webpack 各个生命周期，根据自己的需求使用具体的生命周期即可（Tapable）</p> <ul><li>loader</li></ul> <p>自定义 loader 通过 module.exports 导出一个函数，函数内可以获取的源代码，对源代码做处理后 return 返回编译后的代码。</p> <p>常用方法：</p> <ol><li>this.getOptions 获取 loader 相关参数</li> <li>this.async 获取回调可以在 loader 内部做相关异步操作</li> <li>this.callback 同步回调，功能和函数内 return 作用一样</li></ol> <h2 id="webpack-的热更新原理"><a href="#webpack-的热更新原理" class="header-anchor">#</a> Webpack 的热更新原理</h2> <p>webpack-dev-server 与浏览器之间维护一个 websocket，当本地资源发生变化时，webpack-dev-server 会想浏览器推送更新，并带上构建时的 hash，让客户端与上一次资源进行对比，如有差异就会向 webpack-dev-server 发起请求获取更高内容（文件列表，hash）这样客户端就可以再借助这些信息想 webpack-dev-server 发起 jsonp 请求获取 chunk 的增量更新，拿到增量更新后，由 HotModulePlugin 这个插件处理</p> <h2 id="常见优化方法"><a href="#常见优化方法" class="header-anchor">#</a> 常见优化方法</h2> <p>优化主要两方面入手，减小打包产物体积大小和提高构建速度。</p> <h3 id="减小打包产物体积大小"><a href="#减小打包产物体积大小" class="header-anchor">#</a> 减小打包产物体积大小</h3> <p>使用 webpack-bundle-analyzer 查看打包后生成的 bundle 体积分析</p> <ul><li><p>代码压缩
optimization.minimizer 中初始化 CssMinimizerPlugin、TerserWebpackPlugin</p> <ul><li>js 通过 TerserWebpackPlugin（生产模式会自动开启）</li> <li>css 通过 optimization.minimizer 配置压缩插件 CssMinimizerPlugin</li></ul></li> <li><p>公共代码提取</p> <ul><li>js 通过 SplitChunksPlugin 插件开箱即用，可以将公共的模块提取到已有的入口 chunk 中，或者提取到一个新生成的 chunk。</li> <li>css 通过 MiniCssExtractPlugin 插件将 CSS 提取到单独的文件中，为每个包含 CSS 的 JS 文件创建一个 CSS 文件，并且支持 CSS 和 SourceMaps 的按需加载。</li></ul></li> <li><p>Tree-Shaking</p> <ul><li>Webpack5 自动集成 js 代码剔除</li> <li>css 通过配置 PurgeCSSPlugin 插件实现代码剔除</li></ul></li> <li><p>图片压缩 base64</p></li></ul> <h3 id="提高构建速度"><a href="#提高构建速度" class="header-anchor">#</a> 提高构建速度</h3> <p>speed-measure-webpack-plugin 插件进行构建速度分析，可以看到各个 loader、plugin 的构建时长，后续可针对耗时 loader、plugin 进行优化。</p> <ul><li>thread-loader 开启多 cpu 打包</li> <li>通过配置 webpack 持久化缓存 cache: filesystem，来缓存生成的 webpack 模块和 chunk，改善构建速度。</li> <li>为 loader 指定 include，减少 loader 应用范围</li></ul> <h2 id="webpack-构建流程"><a href="#webpack-构建流程" class="header-anchor">#</a> Webpack 构建流程</h2> <ol><li>初始化参数：从配置文件和 shell 语句中读取与合并参数，得出最终的参数</li> <li>开始编译：用上一步的到的参数初始化 Compiler 对象，加载所有配置的插件，执行对象的 run 方法开始执行编译</li> <li>确定入口：根据配置中的 entry 找到所有入口文件</li> <li>编译模块：从入口文件出发，调用所有配置的 Loader 对模块进行翻译，再找出该模块依赖的模块，再递归本步骤直到所有入口依赖的文件都经过了本步骤的处理</li> <li>完成模块编译：在经过第 4 步使用 Loader 翻译完所有模块后，得到了每个模块被翻译后的最终内容以及依赖关系</li> <li>输出资源：根据入口和模块之间的依赖关系，组装成一个个包含多个模块的 chunk 再把这个 chunk 转换成一个单独的文件加入到输出列表</li> <li>输出完成：确定输出内容后，根据配置确定输出的路径和文件名，把文件内容写入到文件系统</li></ol> <h2 id="webpack-构建原理"><a href="#webpack-构建原理" class="header-anchor">#</a> Webpack 构建原理</h2> <p>通过 babylon 分析代码生成 ast 语法树，通过 babel-traverse 分析 ast 中的依赖关系，以及 babel-core 将 ast 解析成 es5 代码，可以拿到所有的依赖关系及模块代码。最后通过函数自执行的方式执行所有代码</p></div> <footer class="page-edit"><!----> <!----></footer> <div class="page-nav"><p class="inner"><span class="prev">
      ←
      <a href="/work-record/工程化/打包构建的思考.html" class="prev">
        关于构建工具的一些思考
      </a></span> <span class="next"><a href="/work-record/工具类相关/Charles.html">
        Charles 抓包
      </a>
      →
    </span></p></div> </main></div><div class="global-ui"></div></div>
    <script src="/work-record/assets/js/app.bb96a932.js" defer></script><script src="/work-record/assets/js/2.8cd38eb8.js" defer></script><script src="/work-record/assets/js/25.8395cccb.js" defer></script>
  </body>
</html>
